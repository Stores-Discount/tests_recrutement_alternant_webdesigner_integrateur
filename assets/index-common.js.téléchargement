!function(){var width=window.outerWidth,delay=null;function incrementQuantity(e){var target=!1;if(e.target.classList.contains("plus-qty")?target=e.target:e.target.parentElement.classList.contains("plus-qty")&&(target=e.target.parentElement),target){var qtyInput=target.parentElement.children[1];qtyInput.value=parseInt(qtyInput.value)+1,quantityUpdate({target:qtyInput})}}function decrementQuantity(e){var target=!1;if(e.target.classList.contains("minus-qty")?target=e.target:e.target.parentElement.classList.contains("minus-qty")&&(target=e.target.parentElement),target){var qtyInput=target.parentElement.children[1];parseInt(qtyInput.value)>=2?(qtyInput.value=parseInt(qtyInput.value)-1,quantityUpdate({target:qtyInput})):1===parseInt(qtyInput.value)&&generateModal(1,{form:document.getElementById(target.getAttribute("data-delete-form"))})}}function quantityUpdate(e){delay=function(delay,callback){delay&&clearTimeout(delay);return setTimeout(callback,500)}(delay,function(){var input,formData,cartItemId,quantityLoader;input=e.target,formData=new FormData,cartItemId=input&&input.dataset.cartItemId?input.dataset.cartItemId:null,quantityLoader=input.parentNode.querySelector(".cartZone_productGroup-product-header_form_quantity"),formData.append("quantity",input.value),input.style.background="#eee",quantityLoader.style.display="block",setTimeout(function(){xhr=new XMLHttpRequest,xhr.onreadystatechange=function(){4==this.readyState&&200==this.status?location.reload():4==this.readyState&&200!=this.status&&(quantityLoader.style.display="none",console.log("tech : pb possible retour de maj panier"))},xhr.open("POST","/carts/items/update/"+cartItemId+"/",!0),xhr.send(formData)},100)})}function deleteProduct(e){generateModal(1,{form:findClosestForm(e.target)})}function saveCart(){generateModal(2)}function prdAvailabilityNotif(){generateModal(5)}function generateModal(type,additionnalValue){var content="",title="",cssSettings={},noPadding=!1,modalTemplate=document.getElementById("cart-modal-template");switch(type){case 1:(content=modalTemplate.querySelector("#delete-item-modal").cloneNode(!0)).querySelector("button.reject").addEventListener("click",function(){closeModalAction(".generatedModal")}),content.querySelector("button.accept").addEventListener("click",function(){closeModalAction(".generatedModal"),additionnalValue.form.submit()}),cssSettings={class:"smallModal"};break;case 2:(content=modalTemplate.querySelector("#save-cart-modal").cloneNode(!0)).querySelector("#saveCartNewsletter").id="modaleSsaveCartNewsletter",content.querySelector("#saveCartNewsletterLabel").setAttribute("for","modaleSsaveCartNewsletter"),cssSettings={class:"smallModal save-cart-modal"},content.querySelector('form#save-cart-form input[type="submit"]').addEventListener("click",function(e){var modalContent,formData,infoField,loader;return e.preventDefault(),TcEventsTrigger(this,"save_panier_conf",{click_name:"sauvegarder_panier"}),modalContent=content,formData=new FormData,infoField=modalContent.querySelector("form#save-cart-form #info-message"),(loader=modalContent.querySelector("form#save-cart-form .btnLoader")).style="block",formData.append("email",modalContent.querySelector('form#save-cart-form input[type="text"]').value),formData.append("newsletter",modalContent.querySelector('form#save-cart-form input[type="checkbox"]').checked),xhr=new XMLHttpRequest,xhr.onreadystatechange=function(){4==this.readyState&&(infoField.style.color=null),4==this.readyState&&200==this.status?(generateModal(3),loader.style="none"):4==this.readyState&&200!=this.status&&(infoField.style.color="red",infoField.innerHTML=JSON.parse(xhr.responseText).error,loader.style="none")},xhr.open("POST","/carts/save/",!0),xhr.send(formData),!1}),content.querySelector(".rea-close-tiny .close-tiny").addEventListener("click",function(e){closeModalAction(".generatedModal")}),content.querySelector(".div-close-tiny .close-tiny").addEventListener("click",function(e){closeModalAction(".generatedModal")}),noPadding=!0;break;case 3:(content=modalTemplate.querySelector("#cart-saved-modal").cloneNode(!0)).querySelector("#wonderpushTriggerRadio").id="wonderpushTriggerRadioModal","object"==typeof WonderPush&&WonderPush.push(function(){WonderPush.showSubscriptionSwitch(document.getElementById("wonderpushTriggerRadioModal"),{colorOn:"#ffcc33"})}),cssSettings={class:"smallModal save-cart-modal"},noPadding=!0;break;case 4:(content=modalTemplate.querySelector("#remove-cart-discount-modal").cloneNode(!0)).querySelector("button.cancel").addEventListener("click",function(){additionnalValue.cancelCallback(),closeModalAction(".generatedModal")}),content.querySelector("button.confirm").addEventListener("click",function(){additionnalValue.successCallback(),closeModalAction(".generatedModal")}),cssSettings={class:"smallModal"},title="Votre remise exceptionnelle est sur le point d'être supprimée";break;case 5:(content=modalTemplate.querySelector("#product-unavailable-modal").cloneNode(!0)).querySelector("#prdUnavailableNewsletter").id="modalePrdUnavailableNewsletter",content.querySelector("#prdUnavailableNewsletterLabel").setAttribute("for","modalePrdUnavailableNewsletter"),cssSettings={class:"smallModal save-cart-modal"},content.querySelector('form#product-unavailable-form input[type="submit"]').addEventListener("click",function(e){var modalContent,infoField;return e.preventDefault(),infoField=(modalContent=content).querySelector("form#product-unavailable-form #info-message"),xhr=new XMLHttpRequest,xhr.onreadystatechange=function(){4==this.readyState&&(infoField.style.color=null),4==this.readyState&&200==this.status?(infoField.style.color="green",infoField.innerHTML="Votre demande a bien été prise en compte",setTimeout(function(){closeModalAction(".generatedModal")},2e3)):4==this.readyState&&200!=this.status&&(infoField.style.color="red",infoField.innerHTML=JSON.parse(xhr.responseText).error)},newsletter=modalContent.querySelector('form#product-unavailable-form input[type="checkbox"]').checked,data={email:modalContent.querySelector('form#product-unavailable-form input[type="text"]').value,newsletter:newsletter,produit:window.location.pathname,urlProduit:window.location.href,comesFrom:newsletter?["newsletter"]:null},xhr.open("POST","/api/v1/sfmc/product-out-of-stock/",!0),xhr.setRequestHeader("Content-Type","application/json"),xhr.send(JSON.stringify(data)),!1}),noPadding=!1}createModalAction(title,content,cssSettings,noPadding)}function showConfiguration(e){var target=!1;if(e.target.classList.contains("config-toggle")?target=e.target:e.target.parentElement.classList.contains("config-toggle")&&(target=e.target.parentElement),target){var configTarget=target.parentElement.children[1];target.classList.contains("active")?(target.classList.remove("active"),configTarget.classList.remove("active"),slideUp(configTarget,300)):(target.classList.add("active"),configTarget.classList.add("active"),slideDown(configTarget,300))}}function makeValidateButtonSticky(){var validateCartBTN=document.querySelector(".btn-validate-cart"),saveCartBTN=document.querySelector(".btn-save-cart");if(validateCartBTN&&saveCartBTN){var distance=saveCartBTN.getBoundingClientRect(),elmHeight=saveCartBTN.offsetHeight;if(window.outerHeight)var windowHeight=window.outerHeight;else windowHeight=window.innerHeight;width<768&&(distance.top>0&&distance.top>windowHeight-elmHeight?validateCartBTN.classList.add("sticky"):validateCartBTN.classList.remove("sticky"))}}function findClosestForm(node){return"FORM"===node.nodeName?node:"BODY"===node.nodeName?null:findClosestForm(node.parentNode)}function addCode(e,data,formLock){var callback=function(){};if(!formLock.isLocked){void 0!==data.callback&&(callback=data.callback);var saveValue=data.input.value;formLock.isLocked=!0,e.target.querySelector(".text-button").classList.add("hidden"),e.target.querySelector(".lds-ring").classList.remove("hidden");var formData=new FormData;formData.append("coupon",data.input.value);var savTitle=document.querySelector(".promo_title");savTitle&&(savTitle=savTitle.innerHTML),xhr=new XMLHttpRequest,xhr.onreadystatechange=function(){if(4==this.readyState)if(e.target.querySelector(".text-button").classList.remove("hidden"),e.target.querySelector(".lds-ring").classList.add("hidden"),formLock.isLocked=!1,200==this.status){data.input.classList.remove("error-field"),document.querySelector(".add-promo-code").classList.add("hidden"),document.querySelector(".successful-promo-code-added").classList.remove("hidden"),data.informationBlock.classList.remove("hidden"),data.inputBlock.classList.add("hidden"),data.informationBlock.querySelector("span").textContent=data.input.value,data.input.value="",data.chevron.classList.add("fa-chevron-down"),data.chevron.classList.remove("fa-chevron-up"),document.querySelector("#error-promo-code").classList.add("hidden"),document.querySelector("#info-promo-code").classList.add("hidden");try{var result=JSON.parse(this.responseText)}catch(e){result={}}void 0!==result.cart&&(TcEventsTrigger(this,"order_promo_code",{order_promo_code_status:"correct",order_promo_code:saveValue}),updatePrices(result.cart),savTitle&&(function(cart,promoName){var info=!1;for(var promotionName in cart.pricing.details.totalOrderPromotionsPrice)if(promoName==promotionName){info=!0;break}return info}(result.cart,savTitle)||document.querySelector("#info-promo-code").classList.remove("hidden")),callback())}else{TcEventsTrigger(this,"order_promo_code",{order_promo_code_status:"erreur",order_promo_code:saveValue});try{result=JSON.parse(this.responseText)}catch(e){result={message:""}}data.input.classList.add("error-field"),document.querySelector("#error-promo-code").classList.remove("hidden"),document.querySelector("#error-promo-code").innerHTML=result.message,bindConnectShortcut()}},xhr.open("POST","/promo-code/",!0),xhr.send(formData)}}function removeCode(e,data){return e.preventDefault(),data.deleteLink.classList.add("hidden"),data.informationBlock.querySelector(".lds-ring").classList.remove("hidden"),xhr=new XMLHttpRequest,xhr.onreadystatechange=function(){if(4==this.readyState&&(data.deleteLink.classList.remove("hidden"),data.informationBlock.querySelector(".lds-ring").classList.add("hidden"),200==this.status)){document.querySelector(".add-promo-code").classList.remove("hidden"),document.querySelector(".successful-promo-code-added").classList.add("hidden"),document.querySelector("#info-promo-code").classList.add("hidden"),data.informationBlock.classList.add("hidden"),data.inputBlock.classList.remove("hidden"),data.promoCodeContainer.style.height=null,data.promoCodeContainer.classList.remove("open-wrapper");try{var result=JSON.parse(this.responseText)}catch(e){result={}}void 0!==result.cart&&updatePrices(result.cart)}},xhr.open("DELETE","/promo-code/",!0),xhr.send(null),!1}function updatePrices(cart){var promoZone=document.querySelector(".cartZone_recap-price__total-and-promo .promo-container"),ttcZone=document.querySelector(".cartZone_recap-price .cartZone_recap-price__total-ttc .total-ttc .total-ttc_value"),vatZone=document.querySelector(".cartZone_recap-price .cartZone_recap-price__total-ttc .total-tva .total-tva_value"),totalPrice=cart.pricing.total,vatPrice=0;for(cart.pricing.adjustment.forEach(function(adjustment){"tax"===adjustment.type&&(vatPrice+=adjustment.amount)});promoZone.firstChild;)promoZone.removeChild(promoZone.firstChild);for(var promotionName in cart.pricing.details.totalOrderPromotionsPrice){var promoWrapper=document.createElement("span"),promoTitle=document.createElement("span"),promoValue=document.createElement("span");promoWrapper.classList.add("promo"),promoTitle.classList.add("promo_title"),promoValue.classList.add("promo_value"),promoTitle.textContent=promotionName,promoValue.textContent=Math.abs(cart.pricing.details.totalOrderPromotionsPrice[promotionName])+" €",promoWrapper.appendChild(promoTitle),promoWrapper.appendChild(promoValue),promoZone.appendChild(promoWrapper)}ttcZone.textContent=totalPrice/100+" €",vatZone.textContent=vatPrice/100+" €"}function bindConnectShortcut(){var shortcut=document.querySelector("#error-promo-code .error-user-connection");shortcut&&shortcut.addEventListener("click",function(){window.innerWidth>=1088?(void 0!==window.scrollTo?window.scrollTo({top:0,left:0,behavior:"smooth"}):window.scrollBy({top:0,left:0,behavior:"smooth"}),document.querySelector("header .header-container .account-column .dropdown.form-engine").style.display="block"):window.location.href="/identification/connexion/"})}function manageDiscountPopin(e,el,successCallback,cancelCallback){el&&(el.dataset.discountWarning||el.getAttribute("dataset-discount-warning"))?generateModal(4,{successCallback:function(){successCallback(e)},cancelCallback:function(){void 0!==cancelCallback&&cancelCallback(e)}}):successCallback(e)}window.addEventListener("resize",function(){width=window.outerWidth?window.outerWidth:document.body.offsetWidth,function(){if(width>767){var productsConfigurations=Array.from(document.querySelectorAll(".config-toggle-target"));productsConfigurations.forEach(function(config){config.hasAttribute("style")&&config.removeAttribute("style")})}}(),makeValidateButtonSticky()}),window.addEventListener("orientationchange",function(){makeValidateButtonSticky()}),window.addEventListener("mouseout",function(evt){window.location.pathname.indexOf("/commande/paiement-fin")&&(null!=evt.toElement||null!=evt.relatedTarget||localStorage.getItem("displaySaveCartModal")||(cartItem=parseInt(document.querySelector("#cart-item-count").textContent),cartItem>0&&(localStorage.setItem("displaySaveCartModal",!0),generateModal(2))))}),document.addEventListener("DOMContentLoaded",function(){var qtyInputs=Array.from(document.querySelectorAll(".productQTE")),incrementQty=Array.from(document.querySelectorAll(".plus-qty")),decrementQty=Array.from(document.querySelectorAll(".minus-qty")),deleteProducts=Array.from(document.querySelectorAll(".cartZone_productGroup-product-header_delete_product"));qtyInputs.forEach(function(input){var value=input.value,timeout=null;input.addEventListener("keyup",function(e){e.target.value!=value&&(timeout&&clearTimeout(timeout),setTimeout(function(){manageDiscountPopin(e,input,function(){value=e.target.value,quantityUpdate(e)},function(){e.target.value=value}),timeout=null},300))})}),incrementQty.forEach(function(btn){btn.addEventListener("click",function(e){manageDiscountPopin(e,btn,incrementQuantity)})}),decrementQty.forEach(function(btn){btn.addEventListener("click",function(e){manageDiscountPopin(e,btn,decrementQuantity)})}),deleteProducts.forEach(function(btn){btn.addEventListener("click",function(e){var form=findClosestForm(btn);void 0!==form.dataset.discountWarning&&"1"===form.dataset.discountWarning?manageDiscountPopin(e,form,function(){form.submit()}):manageDiscountPopin(e,btn,deleteProduct)})});var saveCartBTN=document.querySelector(".btn-save-cart"),prdAvailabilityNotifBTN=document.querySelector(".btn-unavailable-product");null!=saveCartBTN&&saveCartBTN.addEventListener("click",saveCart),null!=prdAvailabilityNotifBTN&&prdAvailabilityNotifBTN.addEventListener("click",prdAvailabilityNotif),document.addEventListener("click",showConfiguration),document.addEventListener("scroll",makeValidateButtonSticky),makeValidateButtonSticky(),Array.from(document.querySelectorAll(".cart-funnel-page form a.submitLink")).forEach(function(link){link.addEventListener("click",function(e){return e.preventDefault(),manageDiscountPopin(e,link,function(){link.parentNode.submit()}),!1})}),function(){var promoCodeContainer=document.querySelector("#promo-code");if(promoCodeContainer){var inputBlock=promoCodeContainer.querySelector(".promo-code-input"),informationBlock=promoCodeContainer.querySelector(".promo-code-information"),input=promoCodeContainer.querySelector(".promo-code-input input"),button=promoCodeContainer.querySelector(".promo-code-input .add-promo-code-button"),deleteLink=promoCodeContainer.querySelector(".promo-code-information a"),chevron=promoCodeContainer.querySelector(".promo-code-wrapper-trigger"),formLock={isLocked:!1};promoCodeContainer.querySelector(".promo-code-title").addEventListener("click",function(){document.querySelector(".successful-promo-code-added").classList.contains("hidden")&&(chevron.classList.toggle("fa-chevron-down"),chevron.classList.toggle("fa-chevron-up"),promoCodeContainer.classList.contains("open-wrapper")?(promoCodeContainer.classList.remove("open-wrapper"),promoCodeContainer.classList.add("closing-wrapper"),setTimeout(function(){promoCodeContainer.classList.remove("closing-wrapper")},250)):(promoCodeContainer.classList.add("opening-wrapper"),setTimeout(function(){promoCodeContainer.classList.remove("opening-wrapper"),promoCodeContainer.classList.add("open-wrapper")},250)))}),input.addEventListener("keyup",function(e){13===e.keyCode&&addCode({target:button},{input:input,informationBlock:informationBlock,inputBlock:inputBlock,chevron:chevron},formLock)}),button.addEventListener("click",function(e){addCode(e,{input:input,informationBlock:informationBlock,inputBlock:inputBlock,chevron:chevron},formLock)}),button.addEventListener("touch",function(e){addCode(e,{input:input,informationBlock:informationBlock,inputBlock:inputBlock,chevron:chevron},formLock)}),deleteLink.addEventListener("click",function(e){return removeCode(e,{promoCodeContainer:promoCodeContainer,deleteLink:deleteLink,informationBlock:informationBlock,inputBlock:inputBlock})}),deleteLink.addEventListener("touch",function(e){return removeCode(e,{promoCodeContainer:promoCodeContainer,deleteLink:deleteLink,informationBlock:informationBlock,inputBlock:inputBlock})}),document.querySelector(".btn-validate-cart").addEventListener("click",function(e){return!promoCodeContainer.classList.contains("open-wrapper")||""==input.value||(addCode({target:button},{input:input,informationBlock:informationBlock,inputBlock:inputBlock,chevron:chevron,callback:function(){window.location.href=e.target.href}},formLock),!1)})}}(),bindConnectShortcut()}),window.manageDiscountPopin=manageDiscountPopin}();