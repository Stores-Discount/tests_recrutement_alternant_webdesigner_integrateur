var tinyCartHolder,timedCartTrigger;function triggerTinyCart(e,forcedClose){forcedClose||e&&e.target.classList.contains("close-tiny")?tinyCartHolder.classList.remove("visible"):getValidElementClass(e,"basket-column")&&(tinyCartHolder.classList.contains("visible")||(document.querySelector("header .header-links .dropdown").style.display="none",tinyCartHolder.classList.add("visible"))),getValidElementClass(e,"account-column")&&tinyCartHolder.classList.remove("visible")}function getValidElementClass(e,classToFind){if(e&&e.target){if(e.target.parentElement.parentElement&&e.target.parentElement.parentElement.classList.contains(classToFind))return!0;if(e.target.parentElement.classList.contains(classToFind))return!0}return!1}function closeOnClick(e){(e&&!e.target.classList.contains("delete-tiny-product-icon")&&!e.target.parentElement.classList.contains("delete-tiny-product")||e.target.classList.contains("close-tiny"))&&tinyCartHolder.classList.remove("visible")}function tinyCartPop(content){void 0===content?(xhr=new XMLHttpRequest,xhr.open("GET","/commande/tiny/"),xhr.onload=function(){200==xhr.status&&treatCartXHRChanges(xhr.responseText)},xhr.send()):treatCartXHRChanges(content)}function treatCartXHRChanges(content){tinyCartHolder.innerHTML=content,changeNbProductMP(),"undefined"!=typeof scrollTo&&scrollToElement(document.body),setTimeout(function(){tinyCartHolder.classList.add("visible")},500),setTimeout(function(){tinyCartHolder.isMouseOver||triggerTinyCart(null,!0)},4e3),setHeightMobile()}function changeNbProductMP(){var tinyCartProducts=document.querySelector(".tiny-products"),headerPictoEmptyMP=document.querySelector(".headerPictoEmptyMP"),headerPictoMP=document.querySelector(".headerPictoMP");tinyCartProducts&&tinyCartProducts.getAttribute("data-nbproducts")&&tinyCartProducts.getAttribute("data-nbproducts")>0?(document.querySelector("#cart-item-count").textContent=tinyCartProducts.getAttribute("data-nbproducts"),headerPictoEmptyMP&&(headerPictoEmptyMP.classList.remove("headerPictoEmptyMP"),headerPictoEmptyMP.classList.add("headerPictoMP"))):headerPictoMP&&(document.querySelector("#cart-item-count").textContent="",headerPictoMP.classList.add("headerPictoEmptyMP"),headerPictoMP.classList.remove("headerPictoMP"))}function setHeightMobile(){if(document.body.offsetWidth<769){var headerWrap=document.querySelector("#header-wrap"),headerWrapHeight=0;headerWrap&&(headerWrapHeight=headerWrap.offsetHeight);var logo=document.querySelector(".logo-column"),productsZone=document.querySelector(".tiny-products"),toStick=document.querySelector(".toStick"),maxHeight=screen.height-(headerWrapHeight+logo.offsetHeight+toStick.offsetHeight);productsZone.offsetHeight>maxHeight&&(productsZone.style.height=maxHeight+"px")}}function deleteProduct(e){if(e.target.classList.contains("delete-tiny-product-icon")&&e.target.parentElement.classList.contains("delete-tiny-product")){e.preventDefault();var url=null;manageDiscountPopin(e,e.target.parentElement,function(){"I"==e.target.nodeName?(url=e.target.parentElement.getAttribute("data-target"),productLoader=document.querySelector(e.target.parentElement.getAttribute("data-parent")+" .event-loader")):(url=e.target.getAttribute("data-target"),productLoader=document.querySelector(e.target.getAttribute("data-parent")+" .event-loader"));var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){xhr.readyState<4?(productLoader.classList.add("active"),productLoader.classList.add("loadingDelete"),productLoader.innerHTML='<i class="icon-circle_loading sd-spinner"></i>'):4==xhr.readyState&&(productLoader.classList.remove("loadingDelete"),productLoader.classList.add("deleteSuccess"),productLoader.innerHTML='<i class="icon-check_circle_regular"></i> <span>Produit supprim√©</span>',setTimeout(tinyCartPop,500))},xhr.open("POST",url),xhr.send()})}}function makeButtonLoad(state){var button=document.getElementById("SD-submit");switch(state){case"loading":button.classList.add("loadState"),button.innerHTML='<div class="lds-rolling"></div>';break;case"success":button.classList.remove("loadState"),button.classList.add("successState"),button.innerHTML='<i class="icon-check_regular"></i>Ajout&eacute;',setTimeout(function(){button.innerHTML="",button.classList.remove("successState"),button.appendChild(document.createTextNode("Ajouter au panier")),button.classList.remove("disabled")},5e3);break;case"initialize":button.classList.remove("successState"),button.appendChild(document.createTextNode("Ajouter au panier"))}}document.addEventListener("DOMContentLoaded",function(){tinyCartHolder=document.querySelector("#tinyCartHolder");var cartTrigger=document.querySelector(".basket-column"),accountColumn=document.querySelector(".account-column");tinyCartHolder.isMouseOver=!1,document.addEventListener("click",function(e){closeOnClick(e),triggerTinyCart(e),deleteProduct(e)}),cartTrigger.addEventListener("mouseover",function(e){clearTimeout(timedCartTrigger),triggerTinyCart(e)}),cartTrigger.addEventListener("mouseleave",function(e){timedCartTrigger=setTimeout(function(){tinyCartHolder.isMouseOver||triggerTinyCart(e,!0)},2e3)}),tinyCartHolder.addEventListener("mouseover",function(e){this.isMouseOver=!0,clearTimeout(timedCartTrigger)}),tinyCartHolder.addEventListener("mouseleave",function(e){this.isMouseOver=!1,timedCartTrigger=setTimeout(function(){triggerTinyCart(e,!0)},2e3)}),accountColumn.addEventListener("mouseover",triggerTinyCart)});